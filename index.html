<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mini Game Hub ‚Äî Stress Relief</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  html,body { height:100%; }
  canvas { touch-action:none; background: radial-gradient(1000px 600px at 20% 0%, #e0f2fe, #f8fafc); }
  .card { box-shadow: 0 20px 50px rgba(2,132,199,.15), 0 8px 20px rgba(15,23,42,.1); }
</style>
</head>
<body class="min-h-screen bg-gradient-to-b from-sky-50 to-white text-slate-800 antialiased">

<main class="max-w-4xl mx-auto px-4 py-8">
  <div class="card rounded-2xl bg-white border border-slate-100 p-4 md:p-6">
    <!-- Header + Controls -->
    <header class="flex flex-wrap items-center justify-between gap-3">
      <h1 class="text-xl md:text-2xl font-semibold">üéÆ Mini Game Hub</h1>
      <div class="flex flex-wrap items-center gap-2">
        <label class="text-sm text-slate-500">Game:</label>
        <select id="gameSelect" class="rounded-lg border border-slate-300 px-3 py-1.5 text-sm">
          <option value="bubble">ü´ß Chill Bubble Pop</option>
          <option value="brick">üß± Brick Breaker</option>
          <option value="flap">üê¶ Flappy Bird</option>
        </select>

        <!-- Bubble Pop only -->
        <select id="modeSelect" class="rounded-lg border border-slate-300 px-3 py-1.5 text-sm hidden">
          <option value="zen">Zen (‚àû)</option>
          <option value="burst">30s Burst</option>
        </select>

        <button id="startBtn" class="px-4 py-2 rounded-xl bg-sky-600 text-white text-sm hover:bg-sky-700">Start</button>
        <button id="resetBtn" class="px-4 py-2 rounded-xl border border-slate-300 text-sm hover:bg-slate-50">Reset</button>
        <button id="pauseBtn" class="px-4 py-2 rounded-xl border border-slate-300 text-sm hover:bg-slate-50">Pause</button>
      </div>
    </header>

    <!-- Canvas + Sidebar -->
    <section class="mt-4 grid md:grid-cols-[1fr_auto] gap-4">
      <div class="relative rounded-xl overflow-hidden border border-slate-200">
        <canvas id="game" class="w-full h-[58vh] md:h-[62vh] block"></canvas>
        <div id="hint" class="pointer-events-none absolute inset-x-0 bottom-3 text-center text-xs text-slate-500">
          Pilih game dan tekan Start. (Mobile: sentuh skrin)
        </div>
      </div>

      <aside class="grid gap-3 content-start">
        <div class="rounded-xl border border-slate-200 p-3">
          <div id="lab1" class="text-xs text-slate-500">Stat 1</div>
          <div id="val1" class="text-3xl font-semibold">-</div>
        </div>
        <div class="rounded-xl border border-slate-200 p-3">
          <div id="lab2" class="text-xs text-slate-500">Stat 2</div>
          <div id="val2" class="text-3xl font-semibold">-</div>
        </div>
        <div class="rounded-xl border border-slate-200 p-3">
          <div id="lab3" class="text-xs text-slate-500">Stat 3</div>
          <div id="val3" class="text-3xl font-semibold">-</div>
        </div>
        <div id="box4" class="rounded-xl border border-slate-200 p-3">
          <div id="lab4" class="text-xs text-slate-500">Stat 4</div>
          <div id="val4" class="text-3xl font-semibold">-</div>
        </div>
        <div class="text-xs text-slate-500" id="tipBox">
          Tip: Setiap game ada kawalan berbeza. Lihat hint di bawah canvas.
        </div>
      </aside>
    </section>
  </div>
</main>

<script>
/* ===========================================================
   Game Manager ‚Äî satu canvas, pelbagai game
=========================================================== */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d', { alpha: true });
let dpr = Math.max(1, window.devicePixelRatio || 1);
function resizeCanvas() {
  const r = canvas.getBoundingClientRect();
  canvas.width = Math.floor(r.width * dpr);
  canvas.height = Math.floor(r.height * dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0);
  if (current && current.resize) current.resize();
}
resizeCanvas();
window.addEventListener('resize', () => { dpr = Math.max(1, window.devicePixelRatio || 1); resizeCanvas(); });

const gameSelect = document.getElementById('gameSelect');
const modeSelect = document.getElementById('modeSelect');
const startBtn = document.getElementById('startBtn');
const resetBtn = document.getElementById('resetBtn');
const pauseBtn = document.getElementById('pauseBtn');
const hintEl = document.getElementById('hint');
const lab1 = document.getElementById('lab1'), val1 = document.getElementById('val1');
const lab2 = document.getElementById('lab2'), val2 = document.getElementById('val2');
const lab3 = document.getElementById('lab3'), val3 = document.getElementById('val3');
const lab4 = document.getElementById('lab4'), val4 = document.getElementById('val4');
const box4 = document.getElementById('box4');
const tipBox = document.getElementById('tipBox');

function setStats(labels, values) {
  const L = labels.concat(['','','','']).slice(0,4);
  const V = values.concat(['-','-','-']).slice(0,4);
  lab1.textContent = L[0]; lab2.textContent = L[1]; lab3.textContent = L[2]; lab4.textContent = L[3];
  val1.textContent = V[0]; val2.textContent = V[1]; val3.textContent = V[2]; val4.textContent = V[3];
  box4.style.display = L[3] ? 'block' : 'none';
}

function setHint(msg) { hintEl.textContent = msg || ''; }

/* ===========================================================
   GAME 1: ü´ß Chill Bubble Pop
=========================================================== */
function GameBubble() {
  let running=false, paused=false, lastTime=performance.now();
  let bubbles=[], particles=[];
  let lastSpawn=0, score=0, combo=1, comboTimer=0, timeLeft=Infinity, pops=0;
  const rand=(a,b)=>Math.random()*(b-a)+a, clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

  function updateStats(){
    setStats(['Skor','Masa','Combo','Jumlah Pop'], [
      score, timeLeft===Infinity?'‚àû':Math.max(0,Math.ceil(timeLeft)), 'x'+combo.toFixed(1), pops
    ]);
  }

  function spawnBubble(){
    const w=canvas.clientWidth,h=canvas.clientHeight;
    const r=rand(14,36), x=rand(r,w-r), y=h+r+rand(0,40), speed=rand(20,60), hue=rand(180,220);
    bubbles.push({x,y,r,vy:-speed,vx:rand(-10,10), wobbleA:rand(.8,1.4), wobbleT:rand(0,Math.PI*2), hue, alpha:.85});
  }
  function popBubble(i, strong=false){
    const b=bubbles[i]; if(!b) return;
    const n=strong?32:18;
    for(let k=0;k<n;k++){
      const a=rand(0,Math.PI*2), sp=strong?rand(90,180):rand(70,130);
      particles.push({x:b.x,y:b.y,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp,life:rand(.35,.75),size:rand(1.5,3.5),hue:b.hue+rand(-10,10),alpha:1});
    }
    score += 1*combo;
    combo = clamp(combo+.1,1,5);
    comboTimer = 1.2;
    pops += 1;
    if(navigator.vibrate) navigator.vibrate(6);
    bubbles.splice(i,1);
    updateStats();
  }

  function handlePointer(p){
    if(!running || paused) return;
    const radius=28; let hit=false;
    for(let i=bubbles.length-1;i>=0;i--){
      const b=bubbles[i], dx=b.x-p.x, dy=b.y-p.y;
      if(dx*dx+dy*dy <= (b.r+radius)*(b.r+radius)){ popBubble(i); hit=true; }
    }
    if(!hit){ particles.push({x:p.x,y:p.y,vx:0,vy:0,life:.25,size:8,hue:210,alpha:.25}); combo=1; updateStats(); }
  }

  function pointerPos(e){ const r=canvas.getBoundingClientRect();
    return e.touches&&e.touches[0] ? {x:e.touches[0].clientX-r.left,y:e.touches[0].clientY-r.top} :
                                     {x:e.clientX-r.left,y:e.clientY-r.top}; }

  function onDown(e){ handlePointer(pointerPos(e)); e.preventDefault(); }
  function onMove(e){ if(e.buttons===1) handlePointer(pointerPos(e)); }

  function update(dt){
    const spawnEvery = modeSelect.value==='zen' ? 0.25 : 0.18;
    lastSpawn+=dt; while(lastSpawn>spawnEvery){ spawnBubble(); lastSpawn-=spawnEvery; }
    for(let i=bubbles.length-1;i>=0;i--){
      const b=bubbles[i]; b.wobbleT+=dt*b.wobbleA; b.x+=Math.cos(b.wobbleT)*12*dt + b.vx*dt*.1; b.y+=b.vy*dt;
      if(b.y < -b.r-20) bubbles.splice(i,1);
    }
    for(let i=particles.length-1;i>=0;i--){
      const p=particles[i]; p.life-=dt; p.x+=p.vx*dt*.5; p.y+=p.vy*dt*.5; p.vy+=40*dt*.5; p.alpha=Math.max(0,p.life*1.5);
      if(p.life<=0) particles.splice(i,1);
    }
    if(combo>1){ comboTimer-=dt; if(comboTimer<=0){ combo=1; } }
    if(modeSelect.value==='burst' && running){ timeLeft -= dt; if(timeLeft<=0){ running=false; timeLeft=0; } }
    updateStats();
  }
  function draw(){
    const w=canvas.clientWidth,h=canvas.clientHeight;
    ctx.clearRect(0,0,w,h);
    for(let i=0;i<6;i++){
      const rx=((i*97)%w), ry=((i*53)%h), rr=60+(i*10);
      const g=ctx.createRadialGradient(rx,ry,0,rx,ry,rr);
      g.addColorStop(0,'rgba(14,165,233,0.06)'); g.addColorStop(1,'rgba(14,165,233,0.0)');
      ctx.fillStyle=g; ctx.beginPath(); ctx.arc(rx,ry,rr,0,Math.PI*2); ctx.fill();
    }
    for(const b of bubbles){
      const g=ctx.createRadialGradient(b.x-b.r*.4,b.y-b.r*.4,b.r*.1,b.x,b.y,b.r);
      g.addColorStop(0,`hsla(${b.hue},80%,70%,${b.alpha})`); g.addColorStop(1,`hsla(${b.hue},90%,55%,${b.alpha*.8})`);
      ctx.fillStyle=g; ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fill();
      ctx.strokeStyle=`hsla(${b.hue},100%,98%,.8)`; ctx.lineWidth=1;
      ctx.beginPath(); ctx.arc(b.x-b.r*.3,b.y-b.r*.3,b.r*.25,0,Math.PI*2); ctx.stroke();
    }
    for(const p of particles){ ctx.fillStyle=`hsla(${p.hue},90%,60%,${p.alpha})`; ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill(); }
  }

  return {
    name: 'bubble',
    init(){
      setHint('Tap/click untuk pecahkan buih ‚Ä¢ Seret jari untuk combo');
      modeSelect.classList.remove('hidden');
      bubbles=[]; particles=[]; score=0; combo=1; comboTimer=0; pops=0;
      timeLeft = (modeSelect.value==='burst') ? 30 : Infinity;
      updateStats();
      canvas.addEventListener('mousedown', onDown);
      canvas.addEventListener('mousemove', onMove);
      canvas.addEventListener('touchstart', onDown, { passive:false });
      canvas.addEventListener('touchmove',  onDown, { passive:false });
    },
    start(){ running=true; paused=false; setHint(''); if(modeSelect.value==='burst') timeLeft=30; },
    reset(){
      running=false; paused=false; bubbles=[]; particles=[]; score=0; combo=1; comboTimer=0; pops=0;
      timeLeft=(modeSelect.value==='burst')?30:Infinity; updateStats(); setHint('Tekan Start untuk mula');
    },
    pauseToggle(){ paused=!paused; setHint(paused?'Paused':''); },
    resize(){ /* nothing special */ },
    destroy(){
      modeSelect.classList.add('hidden');
      canvas.removeEventListener('mousedown', onDown);
      canvas.removeEventListener('mousemove', onMove);
      canvas.removeEventListener('touchstart', onDown);
      canvas.removeEventListener('touchmove', onDown);
    },
    tick(dt){ if(running && !paused) update(dt); draw(); }
  }
}

/* ===========================================================
   GAME 2: üß± Brick Breaker
=========================================================== */
function GameBrick(){
  let running=false, paused=false, score=0, lives=3, level=1;
  const paddle={w:120,h:14,x:0,y:0}, ball={x:0,y:0,r:8,vx:260,vy:-260,speedUp:1.04,maxSpeed:820};
  const bricks={rows:4,cols:8,w:0,h:22,gap:8,top:70,left:16,data:[]};
  function updateStats(){ setStats(['Skor','Nyawa','Level'], [score,lives,level]); }

  function layout(){
    const W=canvas.clientWidth,H=canvas.clientHeight;
    paddle.w=Math.max(80,Math.min(160, W*0.22)); paddle.h=14; paddle.x=(W-paddle.w)/2; paddle.y=H-36;
    bricks.cols=Math.round(Math.max(6,Math.min(12,W/90)));
    bricks.rows=3 + Math.min(5, Math.floor(level/2));
    bricks.gap=8; bricks.left=16; bricks.top=70;
    const totalGap=(bricks.cols-1)*bricks.gap;
    bricks.w=Math.floor((W-bricks.left*2-totalGap)/bricks.cols); bricks.h=22;
    bricks.data=[];
    for(let r=0;r<bricks.rows;r++){ const row=[];
      for(let c=0;c<bricks.cols;c++){ const strength=1+Math.floor((level-1)/2)+(Math.random()<0.15?1:0); row.push({alive:true,strength,x:0,y:0}); }
      bricks.data.push(row);
    }
  }
  function resetBall(){
    const W=canvas.clientWidth,H=canvas.clientHeight;
    ball.x=W/2; ball.y=H-60;
    const base=260+(level-1)*20, ang=(Math.random()*0.6+0.2)*Math.PI, sp=base;
    ball.vx=Math.cos(ang)*sp*(Math.random()<0.5?1:-1); ball.vy=-Math.abs(Math.sin(ang)*sp);
  }
  function resetAll(){ score=0; lives=3; level=1; updateStats(); layout(); resetBall(); running=false; paused=false; setHint('Gerak paddle dengan mouse/seret jari. Tekan Start.'); }

  function setPaddle(clientX){ const r=canvas.getBoundingClientRect(); const x=clientX-r.left; paddle.x=Math.max(0,Math.min(r.width-paddle.w, x-paddle.w/2)); }

  function update(dt){
    if(!running || paused) return;
    ball.x+=ball.vx*dt; ball.y+=ball.vy*dt;
    const W=canvas.clientWidth,H=canvas.clientHeight;
    if(ball.x-ball.r<0){ ball.x=ball.r; ball.vx=Math.abs(ball.vx); }
    if(ball.x+ball.r>W){ ball.x=W-ball.r; ball.vx=-Math.abs(ball.vx); }
    if(ball.y-ball.r<0){ ball.y=ball.r; ball.vy=Math.abs(ball.vy); }
    if(ball.y-ball.r>H){
      lives--; updateStats(); if(navigator.vibrate) navigator.vibrate(30);
      if(lives<=0){ running=false; setHint('Game Over ‚Äî Reset untuk mula semula'); return; }
      resetBall(); setHint('Nyawa tinggal '+lives); setTimeout(()=>setHint(''),700);
    }
    // paddle
    if(ball.y+ball.r>=paddle.y && ball.y-ball.r<=paddle.y+paddle.h &&
       ball.x>=paddle.x && ball.x<=paddle.x+paddle.w && ball.vy>0){
      const hit=(ball.x-(paddle.x+paddle.w/2))/(paddle.w/2);
      const angle = hit*(Math.PI/3);
      const speed=Math.min(Math.hypot(ball.vx,ball.vy)*ball.speedUp, ball.maxSpeed);
      ball.vx=Math.sin(angle)*speed; ball.vy=-Math.abs(Math.cos(angle)*speed);
      ball.y=paddle.y-ball.r-0.1; if(navigator.vibrate) navigator.vibrate(10);
    }
    // bricks
    let left=0;
    for(let r=0;r<bricks.rows;r++){
      for(let c=0;c<bricks.cols;c++){
        const b=bricks.data[r][c]; if(!b.alive) continue; left++;
        b.x = bricks.left + c*(bricks.w+bricks.gap);
        b.y = bricks.top  + r*(bricks.h+bricks.gap);
        const bx=b.x, by=b.y, bw=bricks.w, bh=bricks.h;
        const cx=Math.max(bx,Math.min(ball.x,bx+bw)), cy=Math.max(by,Math.min(ball.y,by+bh));
        const dx=ball.x-cx, dy=ball.y-cy;
        if(dx*dx+dy*dy<=ball.r*ball.r){
          const ox=Math.min(Math.abs((ball.x+ball.r)-bx), Math.abs((bx+bw)-(ball.x-ball.r)));
          const oy=Math.min(Math.abs((ball.y+ball.r)-by), Math.abs((by+bh)-(ball.y-ball.r)));
          if(ox<oy) ball.vx*=-1; else ball.vy*=-1;
          b.strength--; score += (b.strength<=0)?10:5; if(b.strength<=0) b.alive=false; updateStats();
          if(navigator.vibrate) navigator.vibrate(8);
        }
      }
    }
    if(left===0){ running=false; level++; updateStats(); setHint('Level ' + level + ' ‚Äî Go!'); layout(); resetBall(); setTimeout(()=>{running=true; setHint('');},500); }
  }
  function draw(){
    const W=canvas.clientWidth,H=canvas.clientHeight;
    ctx.clearRect(0,0,W,H);
    // grid
    ctx.strokeStyle='rgba(2,132,199,.06)'; ctx.lineWidth=1;
    for(let x=0;x<W;x+=40){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,H); ctx.stroke(); }
    for(let y=0;y<H;y+=40){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(W,y); ctx.stroke(); }
    // bricks
    const colors=['#22c55e','#06b6d4','#8b5cf6','#eab308','#ef4444','#f97316'];
    for(let r=0;r<bricks.rows;r++){
      for(let c=0;c<bricks.cols;c++){
        const b=bricks.data[r][c]; if(!b.alive) continue;
        const x=b.x, y=b.y, w=bricks.w, h=bricks.h;
        const col = colors[(r+c+b.strength)%colors.length];
        ctx.fillStyle=col; roundRect(ctx,x,y,w,h,6,true);
        ctx.fillStyle='rgba(255,255,255,.3)'; roundRect(ctx,x+4,y+4, Math.max(18,w*(0.25+0.1*b.strength)), h/3, 6, true);
      }
    }
    // paddle
    ctx.fillStyle='#0ea5e9'; roundRect(ctx,paddle.x,paddle.y,paddle.w,paddle.h,8,true);
    const g=ctx.createLinearGradient(paddle.x,paddle.y,paddle.x,paddle.y+paddle.h);
    g.addColorStop(0,'rgba(255,255,255,.45)'); g.addColorStop(1,'rgba(255,255,255,0)');
    ctx.fillStyle=g; roundRect(ctx,paddle.x,paddle.y,paddle.w,paddle.h/2,8,true);
    // ball
    const gb=ctx.createRadialGradient(ball.x-3,ball.y-3,1,ball.x,ball.y,ball.r);
    gb.addColorStop(0,'rgba(14,165,233,.9)'); gb.addColorStop(1,'rgba(14,165,233,.5)');
    ctx.fillStyle=gb; ctx.beginPath(); ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle='rgba(255,255,255,.9)'; ctx.lineWidth=1; ctx.beginPath(); ctx.arc(ball.x-2,ball.y-2,ball.r*.5,0,Math.PI*2); ctx.stroke();
    // top bar
    ctx.fillStyle='rgba(2,132,199,.08)'; ctx.fillRect(0,50,W,2);
  }
  function roundRect(ctx,x,y,w,h,r,fill){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); fill?ctx.fill():ctx.stroke(); }

  function onMouseMove(e){ setPaddle(e.clientX); }
  function onTouch(e){ setPaddle(e.touches[0].clientX); }

  return {
    name:'brick',
    init(){ setHint('Gerakkan paddle dengan mouse / seret jari. Pecahkan semua brick untuk naik level.');
      layout(); resetBall(); updateStats();
      canvas.addEventListener('mousemove', onMouseMove);
      canvas.addEventListener('touchstart', onTouch, { passive:true });
      canvas.addEventListener('touchmove', onTouch, { passive:true });
    },
    start(){ running=true; paused=false; setHint(''); },
    reset(){ resetAll(); },
    pauseToggle(){ paused=!paused; setHint(paused?'Paused':''); },
    resize(){ layout(); },
    destroy(){
      canvas.removeEventListener('mousemove', onMouseMove);
      canvas.removeEventListener('touchstart', onTouch);
      canvas.removeEventListener('touchmove', onTouch);
    },
    tick(dt){ update(dt); draw(); }
  }
}

/* ===========================================================
   GAME 3: üê¶ Flappy Bird (simple)
=========================================================== */
function GameFlap(){
  let running=false, paused=false, best=0, score=0;
  const bird={x:0,y:0,r:10,vy:0};
  let pipes=[], time=0;
  const G=900; // gravity px/s^2
  const FLAP=-300; // flap impulse
  function updateStats(){ setStats(['Skor','Rekod','Kelajuan'], [score, best, '‚Üë tap utk flap']); }

  function reset(){
    const W=canvas.clientWidth,H=canvas.clientHeight;
    bird.x=W*0.3; bird.y=H*0.5; bird.vy=0; score=0; pipes=[]; time=0; updateStats();
  }
  function spawnPipe(){
    const W=canvas.clientWidth,H=canvas.clientHeight;
    const gap=Math.max(120, Math.min(180, H*0.32));
    const mid= (H*0.35) + Math.random()* (H*0.3);
    const topH = Math.max(30, mid - gap/2);
    const botY = mid + gap/2;
    const pipeW = Math.max(46, Math.min(60, W*0.1));
    pipes.push({x:W+30, w:pipeW, top:topH, botY:botY, passed:false});
  }

  function flap(){ if(!running) { running=true; paused=false; setHint(''); } bird.vy = FLAP; if(navigator.vibrate) navigator.vibrate(6); }

  function update(dt){
    if(!running || paused) return;
    time += dt;
    // bird physics
    bird.vy += G*dt;
    bird.y += bird.vy*dt;

    const W=canvas.clientWidth,H=canvas.clientHeight;
    // spawn pipes
    if(time>1.3){ time=0; spawnPipe(); }
    // move pipes
    const speed = Math.max(180, 220 + score*6);
    for(const p of pipes){ p.x -= speed*dt; }
    // remove offscreen
    pipes = pipes.filter(p=> p.x + p.w > -40);

    // collisions
    if(bird.y - bird.r < 0){ bird.y=bird.r; bird.vy=0; }
    if(bird.y + bird.r > H){ gameOver(); return; }

    for(const p of pipes){
      // scoring
      if(!p.passed && bird.x > p.x + p.w){ p.passed=true; score++; best=Math.max(best,score); updateStats(); }
      // hit?
      if(bird.x + bird.r > p.x && bird.x - bird.r < p.x + p.w){
        if(bird.y - bird.r < p.top || bird.y + bird.r > p.botY){ gameOver(); return; }
      }
    }
  }

  function gameOver(){
    running=false; setHint('Game Over ‚Äî Tap/klik untuk mula semula'); if(navigator.vibrate) navigator.vibrate(40);
  }

  function draw(){
    const W=canvas.clientWidth,H=canvas.clientHeight;
    ctx.clearRect(0,0,W,H);
    // ground line
    ctx.fillStyle='rgba(2,132,199,.08)'; ctx.fillRect(0,H-40,W,2);

    // pipes
    ctx.fillStyle='#10b981';
    for(const p of pipes){
      // top
      ctx.fillRect(p.x, 0, p.w, p.top);
      // bottom
      ctx.fillRect(p.x, p.botY, p.w, H - p.botY);
      // edge
      ctx.fillStyle='rgba(255,255,255,.2)';
      ctx.fillRect(p.x, p.top-6, p.w, 4);
      ctx.fillRect(p.x, p.botY+2, p.w, 4);
      ctx.fillStyle='#10b981';
    }
    // bird
    const g=ctx.createRadialGradient(bird.x-4,bird.y-4,1,bird.x,bird.y,bird.r);
    g.addColorStop(0,'#f59e0b'); g.addColorStop(1,'#f97316');
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(bird.x,bird.y,bird.r,0,Math.PI*2); ctx.fill();
    // eye
    ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(bird.x+4,bird.y-4,3,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#111'; ctx.beginPath(); ctx.arc(bird.x+5,bird.y-4,1.5,0,Math.PI*2); ctx.fill();
    // beak
    ctx.fillStyle='#facc15'; ctx.beginPath(); ctx.moveTo(bird.x+bird.r, bird.y); ctx.lineTo(bird.x+bird.r+6, bird.y+3); ctx.lineTo(bird.x+bird.r, bird.y+6); ctx.closePath(); ctx.fill();
  }

  function onDown(){ flap(); }
  function onMove(){ /* not needed */ }

  return {
    name:'flap',
    init(){
      setHint('Tap/klik untuk flap. Elak paip hijau.'); updateStats(); reset();
      canvas.addEventListener('mousedown', onDown);
      canvas.addEventListener('touchstart', onDown, { passive:true });
    },
    start(){ running=true; paused=false; setHint(''); },
    reset(){ reset(); setHint('Tap/klik untuk mula.'); running=false; },
    pauseToggle(){ paused=!paused; setHint(paused?'Paused':''); },
    resize(){ /* nothing */ },
    destroy(){
      canvas.removeEventListener('mousedown', onDown);
      canvas.removeEventListener('touchstart', onDown);
    },
    tick(dt){ update(dt); draw(); }
  }
}

/* ===========================================================
   Wiring manager
=========================================================== */
let current=null;
const games = {
  bubble: GameBubble,
  brick:  GameBrick,
  flap:   GameFlap
};

function loadGame(key){
  if(current && current.destroy) current.destroy();
  current = games[key]();
  current.init();
  // Show/hide extra controls
  if(key==='bubble'){ modeSelect.classList.remove('hidden'); }
  else { modeSelect.classList.add('hidden'); }
}
loadGame(gameSelect.value);

gameSelect.addEventListener('change', ()=>{ loadGame(gameSelect.value); });
modeSelect.addEventListener('change', ()=>{ if(current && current.reset) current.reset(); });

startBtn.addEventListener('click', ()=> current && current.start && current.start());
resetBtn.addEventListener('click', ()=> current && current.reset && current.reset());
pauseBtn.addEventListener('click', ()=> current && current.pauseToggle && current.pauseToggle());

// master loop
let last = performance.now();
function loop(t){
  const now=t||performance.now();
  const dt=Math.min(0.033,(now-last)/1000); // clamp 30fps dt
  last=now;
  if(current && current.tick) current.tick(dt);
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>

</body>
</html>
